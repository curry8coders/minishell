# minishell テストスイート分析レポート

## 概要

`test/test.sh` は、`minishell` の挙動を `bash` と比較して検証するためのシェルスクリプトです。
コマンドライン引数として渡されたコマンド文字列を `bash` と `minishell` の両方で実行し、その結果（標準出力、終了ステータス、生成ファイル）を比較します。

## テストの仕組み

スクリプトは以下の手順でテストを実行します：

1.  **準備**:
    *   一時ディレクトリ `test/tmp` を作成。
    *   `minishell` 本体と `Makefile` へのシンボリックリンクを作成。
    *   テスト用の補助プログラム（`a.out`, `print_args`, `exit42`）をコンパイル。

2.  **比較ロジック (`assert` 関数)**:
    *   **Bash実行**: `echo -n -e "$COMMAND" | bash` を実行し、標準出力を `cmp` ファイルに保存。終了ステータスを記録。
    *   **Minishell実行**: `echo -n -e "$COMMAND" | ./minishell` を実行し、標準出力を `out` ファイルに保存。終了ステータスを記録。無限ループ対策として `timeout` コマンドを使用。
    *   **検証**:
        *   **標準出力**: `diff` コマンドで `cmp` と `out` を比較。
        *   **終了ステータス**: 両者の終了コードが一致するか確認。
        *   **ファイル生成**: リダイレクトテストなどで生成されたファイルの内容を比較。

## テスト範囲（カバレッジ）

現状のテストケースは以下の機能をカバーしています：

*   **基本実行**: 絶対パス、PATH探索、存在しないコマンド。
*   **トークナイズ**: クォート処理（シングル `'`、ダブル `"`）、混合クォート。
*   **リダイレクト**:
    *   出力 (`>`)
    *   入力 (`<`)
    *   追記 (`>>`)
    *   ヒアドキュメント (`<<`) - クォート有無による展開の違いもテスト。
*   **パイプ**: 単純なパイプ接続 (`|`)。
*   **環境変数展開**: `$USER`, `$?`（終了ステータス）。
*   **シグナル**:
    *   シェル本体への `SIGTERM`, `SIGQUIT`, `SIGINT`。
    *   子プロセス実行中のシグナル送信。
*   **ビルトインコマンド**:
    *   `exit`, `export`, `unset`, `env`, `cd`, `echo`, `pwd`。

## Bashとの比較について

**結論: はい、本家の bash と挙動を確認できるものになっています。**

*   すべてのテストケースにおいて、期待値（Expected）として `bash` の実行結果を使用しています。
*   したがって、このテストに通ることは、少なくともテストされた範囲においては `bash` と同じ挙動をしていることを意味します。

## 注意点

*   **標準エラー出力**: 現状のスクリプトでは `2>&-` によって標準エラー出力が閉じられているため、**エラーメッセージの内容は比較されていません**。
*   **環境依存**: `echo -e` オプションや `timeout` コマンド（`gtimeout` 対応あり）を使用しており、環境によっては微調整が必要な場合があります。
